<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <!-- Header -->
    <div class="mb-10 flex flex-col sm:flex-row sm:items-end justify-between gap-4">
        <div>
            <h1 class="text-4xl font-black text-neutral-900 dark:text-white tracking-tight">Your Cart</h1>
            <p class="mt-2 text-neutral-500 dark:text-neutral-400">Check your products before finalizing the purchase.
            </p>
        </div>
        @if (cartItems().length > 0) {
        <button (click)="clearCart()"
            class="flex items-center gap-2 px-4 py-2 text-sm font-bold text-rose-500 hover:bg-rose-50 dark:hover:bg-rose-900/20 rounded-xl transition-all active:scale-95 border border-transparent hover:border-rose-100 dark:hover:border-rose-800">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
            Clear Cart
        </button>
        }
    </div>

    @if (isCompleted()) {
    <!-- Success State -->
    <div
        class="max-w-md mx-auto text-center py-20 bg-emerald-50 dark:bg-emerald-900/20 rounded-[3rem] border-2 border-emerald-100 dark:border-emerald-800/30 relative overflow-hidden">
        <div class="absolute -top-24 -right-24 w-48 h-48 bg-emerald-400/10 rounded-full blur-3xl animate-pulse"></div>
        <div class="absolute -bottom-24 -left-24 w-48 h-48 bg-indigo-400/10 rounded-full blur-3xl animate-pulse"></div>

        <div class="mb-8 relative inline-block">
            <div class="absolute inset-0 bg-emerald-600 blur-3xl opacity-20 animate-pulse"></div>
            <div class="relative bg-white dark:bg-neutral-800 p-6 rounded-full shadow-2xl scale-110">
                <svg class="w-16 h-16 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7" />
                </svg>
            </div>
        </div>

        <h2 class="text-3xl font-black text-neutral-900 dark:text-white mb-4">Â¡Order Completed!</h2>
        <p class="text-neutral-600 dark:text-neutral-400 mb-8 px-10">Thank you for your purchase. We have sent you an
            email with the details of your order.</p>

        <div class="space-y-4">
            <button [routerLink]="['/']"
                class="px-8 py-4 bg-emerald-600 text-white font-black rounded-2xl hover:bg-emerald-500 transition-all shadow-xl shadow-emerald-600/20 active:scale-95 uppercase tracking-widest text-xs">
                Back to Home
            </button>
            <p class="text-[10px] text-neutral-400 uppercase font-black tracking-widest animate-pulse mt-4">Redirecting
                automatically in {{countdown()}}s...</p>
        </div>
    </div>
    } @else if (cartItems().length > 0) {
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-12">
        <!-- Products List -->
        <div class="lg:col-span-8 space-y-6">
            @for (item of cartItems(); track item.id) {
            <div
                class="group relative flex flex-col sm:flex-row items-center gap-6 bg-white dark:bg-neutral-900 p-6 rounded-3xl border border-neutral-100 dark:border-neutral-800 shadow-sm hover:shadow-xl transition-all duration-300">
                <!-- Product Image -->
                <a [routerLink]="['/product', item.id]"
                    class="relative w-32 h-32 flex-shrink-0 overflow-hidden rounded-2xl bg-neutral-50 dark:bg-neutral-800 p-2">
                    <img [src]="item.images[0]" [alt]="item.title"
                        class="w-full h-full object-contain transform group-hover:scale-110 transition-transform duration-500">
                </a>

                <!-- Product Info -->
                <div class="flex-1 min-w-0">
                    <div class="flex justify-between items-start">
                        <div>
                            <span
                                class="text-[10px] font-bold text-indigo-600 dark:text-indigo-400 uppercase tracking-widest">{{item.category}}</span>
                            <h3 class="text-lg font-bold text-neutral-900 dark:text-white truncate mt-1">
                                {{item.title}}
                            </h3>
                            <!-- Discount Badge -->
                            @if (item.discountPercentage >= 1) {
                            <div class="mt-2">
                                <span
                                    class="bg-rose-500/10 text-rose-600 dark:text-rose-400 text-[10px] font-bold px-2 py-1 rounded-lg border border-rose-100 dark:border-rose-900/30">
                                    -{{item.discountPercentage.toFixed(0)}}% OFF
                                </span>
                            </div>
                            }
                        </div>
                        <button (click)="removeItem(item.id)"
                            class="text-neutral-400 hover:text-rose-500 transition-colors p-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                        </button>
                    </div>

                    <div class="mt-4 flex items-center justify-between">
                        <!-- Quantity Selector -->
                        <div class="flex items-center bg-neutral-100 dark:bg-neutral-800 rounded-xl p-1">
                            <button (click)="updateQuantity(item.id, item.quantity - 1)"
                                class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-white dark:hover:bg-neutral-700 transition-colors text-neutral-600 dark:text-neutral-300">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M20 12H4" />
                                </svg>
                            </button>
                            <span
                                class="w-10 text-center text-sm font-bold text-neutral-900 dark:text-white">{{item.quantity}}</span>
                            <button (click)="updateQuantity(item.id, item.quantity + 1)"
                                class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-white dark:hover:bg-neutral-700 transition-colors text-neutral-600 dark:text-neutral-300">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 4v16m8-8H4" />
                                </svg>
                            </button>
                        </div>

                        <!-- Price -->
                        <div class="text-right">
                            <p class="text-xs text-neutral-400 uppercase font-medium">Subtotal</p>
                            <p class="text-xl font-black text-neutral-900 dark:text-white flex flex-col">
                                <span class="text-sm line-through text-neutral-400 font-medium">
                                    ${{(item.price * item.quantity).toFixed(2)}}
                                </span>
                                <span>
                                    ${{ (item.price * item.quantity - getItemDiscount(item)).toFixed(2) }}
                                </span>
                            </p>
                            @if (item.discountPercentage >= 1) {
                            <p class="text-[10px] font-bold text-emerald-500">
                                Save ${{ getItemDiscount(item).toFixed(2) }}
                            </p>
                            }
                        </div>
                    </div>
                </div>
            </div>
            }
        </div>

        <!-- Order Summary -->
        <div class="lg:col-span-4">
            <div
                class="sticky top-24 bg-neutral-900 dark:bg-white text-white dark:text-neutral-900 p-8 rounded-[2.5rem] shadow-2xl overflow-hidden group">
                <!-- Decorative element -->
                <div
                    class="absolute -top-12 -right-12 w-40 h-40 bg-indigo-600/20 rounded-full blur-3xl group-hover:bg-indigo-600/30 transition-colors">
                </div>

                <h2 class="text-2xl font-black mb-8 relative z-10">Order Summary</h2>

                <div class="space-y-4 mb-8 relative z-10">
                    <div class="flex justify-between items-center opacity-80">
                        <span class="text-sm font-medium">Subtotal</span>
                        <span class="text-lg font-bold">${{ subtotal().toFixed(2) }}</span>
                    </div>
                    <div class="flex justify-between items-center opacity-80">
                        <span class="text-sm font-medium">Shipping</span>
                        <span class="text-lg font-bold text-emerald-400 dark:text-emerald-600">Free</span>
                    </div>
                    <div class="flex justify-between items-center opacity-80">
                        <span class="text-sm font-medium">Discount</span>
                        <span
                            class="text-lg font-bold text-emerald-400 dark:text-emerald-600">-{{totalDiscount().toFixed(2)}}</span>
                    </div>
                    <div
                        class="pt-4 border-t border-white/10 dark:border-neutral-200/50 flex justify-between items-center">
                        <span class="text-base font-bold">Total</span>
                        <div class="text-right">
                            <span class="text-3xl font-black tracking-tighter">${{ total().toFixed(2) }}</span>
                            <p class="text-[10px] uppercase font-bold tracking-widest opacity-50">IVA included</p>
                        </div>
                    </div>
                </div>

                <div class="space-y-3 relative z-10">
                    <button (click)="checkout()"
                        class="w-full py-4 bg-indigo-600 hover:bg-indigo-500 text-white font-black rounded-2xl shadow-xl shadow-indigo-600/20 transition-all transform active:scale-[0.98] uppercase tracking-widest text-sm">
                        Finalize Purchase
                    </button>
                    <a [routerLink]="['/products']"
                        class="w-full py-4 flex items-center justify-center text-sm font-bold opacity-60 hover:opacity-100 transition-opacity">
                        Continue Shopping
                    </a>
                </div>
            </div>
        </div>
    </div>
    } @else {
    <!-- Empty State -->
    <div
        class="max-w-md mx-auto text-center py-20 bg-neutral-50 dark:bg-neutral-900/50 rounded-[3rem] border-2 border-dashed border-neutral-200 dark:border-neutral-800">
        <div class="mb-8 relative inline-block">
            <div class="absolute inset-0 bg-indigo-600 blur-3xl opacity-10 animate-pulse"></div>
            <div class="relative bg-white dark:bg-neutral-800 p-6 rounded-full shadow-2xl">
                <svg class="w-16 h-16 text-neutral-300 dark:text-neutral-600" fill="none" stroke="currentColor"
                    viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                        d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                </svg>
            </div>
        </div>
        <h2 class="text-2xl font-black text-neutral-900 dark:text-white mb-4">Your cart is empty</h2>
        <p class="text-neutral-500 dark:text-neutral-400 mb-10 px-8">It looks like you haven't added anything to your
            selection. Explore our products and find something amazing!</p>
        <button [routerLink]="['/products']"
            class="inline-flex items-center justify-center px-8 py-4 bg-neutral-900 dark:bg-white text-white dark:text-black font-black rounded-2xl hover:scale-105 transition-all shadow-xl active:scale-95 uppercase tracking-widest text-xs">
            Go to store
        </button>
    </div>
    }
</div>